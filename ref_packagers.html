

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Model Packagers &mdash; Odahu 1.0.0-rc27 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="_static/nav_content_width.css" type="text/css" />
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Model Deployments" href="ref_deployments.html" />
    <link rel="prev" title="Model Trainings" href="ref_trainings.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Odahu
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="about.html">About Odahu</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="gen_distros.html">Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="gen_security.html">Security</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials_installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials_wine.html">Quickstart</a></li>
</ul>
<p class="caption"><span class="caption-text">Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="comp_api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="comp_operator.html">Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="comp_mlflow_trainer.html">MLFlow Trainer</a></li>
</ul>
<p class="caption"><span class="caption-text">Integrations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="int_metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="int_airflow.html">Airflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="int_jupyterlab_extension.html">JupyterLab extension</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ref_odahuflowctl.html">Odahuflowctl</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref_model_format.html">Model Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref_connections.html">Connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref_trainings.html">Model Trainings</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Model Packagers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#general-packager-structure">General packager structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#packagers-management">Packagers management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#swagger-ui">Swagger UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#odahu-flow-cli">Odahu-flow CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jupyterlab">JupyterLab</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#docker-rest">Docker REST</a></li>
<li class="toctree-l2"><a class="reference internal" href="#docker-cli">Docker CLI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ref_deployments.html">Model Deployments</a></li>
<li class="toctree-l1"><a class="reference internal" href="gen_glossary.html">Glossary</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dev_general.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_project_structure.html">A repository directory structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_project_structure.html#repositories">Repositories</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_project_structure.html#odahu-odahu-infra">odahu/odahu-infra</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_hints.html">Development hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_testing.html">Integration Testing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Odahu</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Model Packagers</li>
    
    
<li class="wy-breadcrumbs-aside">
<a href="odahu-docs.pdf">Get PDF version</a>
</li>

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="model-packagers">
<h1>Model Packagers<a class="headerlink" href="#model-packagers" title="Permalink to this headline">¶</a></h1>
<p>Odahu-flow packagers turn a <a class="reference internal" href="gen_glossary.html#term-trained-model-binary"><span class="xref std std-term">Trained Model Binary</span></a> artifact into a specific application.
You can find the list of out-of-the-box packagers below:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#docker-rest"><span class="std std-ref">Docker REST</span></a></li>
<li><a class="reference internal" href="#docker-cli"><span class="std std-ref">Docker CLI</span></a></li>
</ul>
</div></blockquote>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>A packager installation is the creation of a new PackagingIntegration entity in the <a class="reference internal" href="gen_glossary.html#term-api-service"><span class="xref std std-term">API service</span></a>.
The most straightforward way is to deploy the <cite>odahu-flow-packagers</cite> helm chart.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the odahu-flow helm repository</span>
helm repo add odahu-flow <span class="s1">&#39;https://raw.githubusercontent.com/odahu/odahu-helm/master/&#39;</span>
helm repo update
<span class="c1"># Fill in the values for the chart or leave the default values</span>
helm inspect values odahu-flow/odahu-flow-packagers --version <span class="m">1</span>.0.0-rc35 &gt; values.yaml
vim values.yaml
<span class="c1"># Deploy the helm chart</span>
helm install odahu-flow/odahu-flow-packagers --name odahu-flow-packagers --namespace odahu-flow --debug -f values.yaml --atomic --wait --timeout <span class="m">120</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Odahu-flow must be deployed before the packagers installation.</p>
</div>
</div>
<div class="section" id="general-packager-structure">
<h2>General packager structure<a class="headerlink" href="#general-packager-structure" title="Permalink to this headline">¶</a></h2>
<p>All packagers have the same structure.
But different packagers provide a different set of arguments and targets.
You can find the description of all fields below:</p>
<div class="literal-block-wrapper docutils container" id="packager-api-file">
<div class="code-block-caption"><span class="caption-text">Packager API</span><a class="headerlink" href="#packager-api-file" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Unique value among all packagers</span>
<span class="nt">id</span><span class="p">:</span> <span class="s">&quot;id-12345&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
    <span class="c1"># Type of a packager. Available values: docker-rest, docker-cli.</span>
    <span class="nt">integrationName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">docker-rest</span>
    <span class="c1"># Training output artifact name</span>
    <span class="nt">artifactName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wine-model-123456789.zip</span>
    <span class="c1"># Compute resources</span>
    <span class="nt">resources</span><span class="p">:</span>
      <span class="nt">limits</span><span class="p">:</span>
        <span class="nt">cpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
        <span class="nt">memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1Gi</span>
      <span class="nt">requests</span><span class="p">:</span>
        <span class="nt">cpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
        <span class="nt">memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1Gi</span>
    <span class="c1"># List of arguments. Depends of a Model Packaging integration.</span>
    <span class="c1"># You can find specific values in the sections below.</span>
    <span class="c1"># This parameter is used for customizing of a packaging process.</span>
    <span class="nt">arguments</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
    <span class="c1"># List of targets. Depends of a Model Packaging integration.</span>
    <span class="c1"># You can find specific values in the sections below.</span>
    <span class="c1"># A packager can interact with a Docker registry, PyPi repository, and so on.</span>
    <span class="c1"># You should provide a list of connections for a packager can get access to them.</span>
    <span class="nt">targets</span><span class="p">:</span> <span class="p p-Indicator">[]</span>
    <span class="c1"># You can set connection which points to some bucket where the Trained Model Binary is stored</span>
    <span class="c1"># then packager will extract your binary from this connection</span>
    <span class="nt">outputConnection</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">custom-connection</span>
<span class="c1"># Every packager saves its results into status field.</span>
<span class="c1"># Example of fields: docker image or python packager name.</span>
<span class="nt">status</span><span class="p">:</span>
    <span class="nt">results</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">some_param</span>
          <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">some_value</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can find an artifactName in the <cite>status.artifactName</cite> field of a model training entity.</p>
</div>
</div>
<div class="section" id="packagers-management">
<h2>Packagers management<a class="headerlink" href="#packagers-management" title="Permalink to this headline">¶</a></h2>
<p>Packagers can be managed using the following ways.</p>
<div class="section" id="swagger-ui">
<h3>Swagger UI<a class="headerlink" href="#swagger-ui" title="Permalink to this headline">¶</a></h3>
<p>ModelPackaging and PackagingIntegration are available on the Swagger UI at <a class="reference external" href="http://api-service/swagger/index.html">http://api-service/swagger/index.html</a> URL.</p>
</div>
<div class="section" id="odahu-flow-cli">
<h3>Odahu-flow CLI<a class="headerlink" href="#odahu-flow-cli" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="ref_odahuflowctl.html#odahuflowctl"><span class="std std-ref">Odahuflowctl</span></a> supports the Packagers API.
You must be <a class="reference internal" href="ref_odahuflowctl.html#login"><span class="std std-ref">logged in</span></a> if you want to get access to the API.</p>
<p>Getting all packaging in json format:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>odahuflowctl pack get --format json
</pre></div>
</div>
<p>Getting the arguments of the packagers:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>odahuflowctl pack get --id tensorflow-cli -o <span class="s1">&#39;jsonpath=[*].spec.arguments&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li>Creating of a packager from <cite>pack.yaml</cite> file:</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>odahuflowctl pack create -f pack.yaml
</pre></div>
</div>
<ul class="simple">
<li>All packager commands and documentation:</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>odahuflowctl pack --help
</pre></div>
</div>
</div>
<div class="section" id="jupyterlab">
<h3>JupyterLab<a class="headerlink" href="#jupyterlab" title="Permalink to this headline">¶</a></h3>
<p>Odahu-flow provides the <a class="reference internal" href="int_jupyterlab_extension.html#jupyterlab-extension"><span class="std std-ref">JupyterLab extension</span></a> for interacting with Packagers API.</p>
</div>
</div>
<div class="section" id="docker-rest">
<h2>Docker REST<a class="headerlink" href="#docker-rest" title="Permalink to this headline">¶</a></h2>
<p>The Docker REST packager wraps an ML model into the REST service inside a Docker image.
The resulting service can be used for point prediction thorough HTTP.</p>
<p>The packager provides the following list of targets:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="13%" />
<col width="13%" />
<col width="7%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Target Name</th>
<th class="head">Connection Types</th>
<th class="head">Required</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>docker-push</td>
<td><a class="reference internal" href="ref_connections.html#docker"><span class="std std-ref">docker</span></a>, <a class="reference internal" href="ref_connections.html#amazon-elastic-container-registry"><span class="std std-ref">ecr</span></a></td>
<td>True</td>
<td>The packager will use the connection for pushing a Docker image result</td>
</tr>
<tr class="row-odd"><td>docker-pull</td>
<td><a class="reference internal" href="ref_connections.html#docker"><span class="std std-ref">docker</span></a>, <a class="reference internal" href="ref_connections.html#amazon-elastic-container-registry"><span class="std std-ref">ecr</span></a></td>
<td>False</td>
<td>The packager will use the connection for pulling a custom base Docker image</td>
</tr>
</tbody>
</table>
<p>The packager provides the following list of arguments:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="12%" />
<col width="12%" />
<col width="12%" />
<col width="6%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Argument Name</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Required</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>imageName</td>
<td>string</td>
<td>{{ Name }}-{{ Version }}:{{ RandomUUID }}</td>
<td>False</td>
<td>This option provides a way to specify the Docker image name. You can hardcode the full name or specify a template. Available template values: Name (Model Name), Version (Model Version), RandomUUID. Examples: myservice:123, {{ Name }}:{{ Version }}</td>
</tr>
<tr class="row-odd"><td>port</td>
<td>integer</td>
<td>5000</td>
<td>False</td>
<td>Port to bind</td>
</tr>
<tr class="row-even"><td>timeout</td>
<td>integer</td>
<td>60</td>
<td>False</td>
<td>Serving timeout in seconds.</td>
</tr>
<tr class="row-odd"><td>workers</td>
<td>integer</td>
<td>1</td>
<td>False</td>
<td>Count of serving workers</td>
</tr>
<tr class="row-even"><td>threads</td>
<td>integer</td>
<td>4</td>
<td>False</td>
<td>Count of serving threads</td>
</tr>
<tr class="row-odd"><td>host</td>
<td>string</td>
<td>0.0.0.0</td>
<td>False</td>
<td>Host to bind</td>
</tr>
<tr class="row-even"><td>dockerfileBaseImage</td>
<td>string</td>
<td>python:3.6</td>
<td>False</td>
<td>Base image for Dockerfile</td>
</tr>
<tr class="row-odd"><td>dockerfileAddCondaInstallation</td>
<td>boolean</td>
<td>True</td>
<td>False</td>
<td>Add conda installation code to Dockerfile</td>
</tr>
<tr class="row-even"><td>dockerfileCondaEnvsLocation</td>
<td>boolean</td>
<td>/opt/conda/envs/</td>
<td>False</td>
<td>Conda env location in Dockerfile</td>
</tr>
</tbody>
</table>
<p>The packager provides the following list of result fields:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="14%" />
<col width="14%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>image</td>
<td>string</td>
<td>The full name of a built Docker image</td>
</tr>
</tbody>
</table>
<p>Let’s build a couple of examples of Docker REST packager.
The packager requires <a class="reference internal" href="ref_connections.html#docker"><span class="std std-ref">docker</span></a> or <a class="reference internal" href="ref_connections.html#amazon-elastic-container-registry"><span class="std std-ref">ecr</span></a> connection types.
The following example assumes that you have created a connection with <cite>test-docker-registry</cite> id and <cite>gcr.io/project/odahuflow</cite> URI.</p>
<div class="literal-block-wrapper docutils container" id="minimal-example-of-docker-rest-packager-file">
<div class="code-block-caption"><span class="caption-text">Minimal Example of Docker REST packager</span><a class="headerlink" href="#minimal-example-of-docker-rest-packager-file" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">id</span><span class="p">:</span> <span class="s">&quot;docker-rest-packager-example&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
    <span class="nt">integrationName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">docker-rest</span>
    <span class="nt">artifactName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wine-model-123456789.zip</span>
    <span class="nt">targets</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">connectionName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-docker-registry</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">docker-push</span>
</pre></div>
</div>
</div>
<p>Then a result of the packager will be something like this: “gcr.io/project/odahuflow/wine-0-1:ec1bf1cd-216d-4f0a-a62f-bf084c79c58c”.</p>
<p>Now, let’s try to change the docker image name and number of workers.</p>
<div class="literal-block-wrapper docutils container" id="docker-rest-packager-with-custom-arguments-file">
<div class="code-block-caption"><span class="caption-text">Docker REST packager with custom arguments</span><a class="headerlink" href="#docker-rest-packager-with-custom-arguments-file" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">id</span><span class="p">:</span> <span class="s">&quot;docker-rest-packager-example&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
    <span class="nt">integrationName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">docker-rest</span>
    <span class="nt">artifactName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wine-model-123456789.zip</span>
    <span class="nt">targets</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">connectionName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-docker-registry</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">docker-push</span>
    <span class="nt">arguments</span><span class="p">:</span>
        <span class="nt">imageName</span><span class="p">:</span> <span class="s">&quot;wine-test:prefix-{{</span><span class="nv"> </span><span class="s">RandomUUID</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">workers</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>odahuflowctl pack get --id <span class="s2">&quot;docker-rest-packager-example&quot;</span> -o <span class="s1">&#39;jsonpath=$[0].status.results[0].value&#39;</span>
</pre></div>
</div>
<p>Then a result of the packager will be something like this: “gcr.io/project/odahuflow/wine-test:prefix-ec1bf1cd-216d-4f0a-a62f-bf084c79c58c”.</p>
<p>You can run the image locally using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -it --rm --net host gcr.io/project/odahuflow/wine-test:prefix-ec1bf1cd-216d-4f0a-a62f-bf084c79c58c
</pre></div>
</div>
<p>The model server provides two urls:</p>
<blockquote>
<div><ul class="simple">
<li>GET <cite>/api/model/info</cite> - provides a swagger documentation for a model</li>
<li>POST <cite>/api/model/invoke</cite> - executes a prediction</li>
</ul>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl http://localhost:5000/api/model/info
curl -X POST -d <span class="s1">&#39;{&quot;columns&quot;: [&quot;features&quot;,&quot;features&quot;,&quot;features&quot;], &quot;data&quot;: [[1, 2, 3], [4, 5, 6]]}&#39;</span> -H <span class="s2">&quot;Content-Type: application/json&quot;</span> http://localhost:5000/api/model/invoke
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="docker-rest-predict-api-file">
<div class="code-block-caption"><span class="caption-text">Docker REST predict API</span><a class="headerlink" href="#docker-rest-predict-api-file" title="Permalink to this code">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;columns&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;features&quot;</span><span class="p">,</span>
    <span class="s2">&quot;features&quot;</span><span class="p">,</span>
    <span class="s2">&quot;features&quot;</span>
  <span class="p">],</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">[</span>
      <span class="mi">1</span><span class="p">,</span>
      <span class="mi">2</span><span class="p">,</span>
      <span class="mi">3</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">4</span><span class="p">,</span>
      <span class="mi">5</span><span class="p">,</span>
      <span class="mi">6</span><span class="p">,</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="docker-rest-prediction-result-file">
<div class="code-block-caption"><span class="caption-text">Docker REST prediction result</span><a class="headerlink" href="#docker-rest-prediction-result-file" title="Permalink to this code">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;prediction&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">[</span>
      <span class="mf">0.09405578672885895</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mf">0.01238546592343845</span>
    <span class="p">]</span>
  <span class="p">],</span>
  <span class="nt">&quot;columns&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;predictions&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="docker-cli">
<h2>Docker CLI<a class="headerlink" href="#docker-cli" title="Permalink to this headline">¶</a></h2>
<p>The Docker CLI packager wraps an ML model into the CLI inside a Docker image.
The resulting service can be used for batch prediction.</p>
<p>The packager provides the following list of targets:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="13%" />
<col width="13%" />
<col width="7%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Target Name</th>
<th class="head">Connection Types</th>
<th class="head">Required</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>docker-push</td>
<td><a class="reference internal" href="ref_connections.html#docker"><span class="std std-ref">docker</span></a>, <a class="reference internal" href="ref_connections.html#amazon-elastic-container-registry"><span class="std std-ref">ecr</span></a></td>
<td>The packager will use the connection for pushing a Docker image result</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>docker-pull</td>
<td><a class="reference internal" href="ref_connections.html#docker"><span class="std std-ref">docker</span></a>, <a class="reference internal" href="ref_connections.html#amazon-elastic-container-registry"><span class="std std-ref">ecr</span></a></td>
<td>False</td>
<td>The packager will use the connection for pulling a custom base Docker image</td>
</tr>
</tbody>
</table>
<p>The packager provides the following list of arguments:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="12%" />
<col width="12%" />
<col width="12%" />
<col width="6%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Argument Name</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Required</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>imageName</td>
<td>string</td>
<td>{{ Name }}-{{ Version }}:{{ RandomUUID }}</td>
<td>False</td>
<td>This option provides a way to specify the Docker image name. You can hardcode the full name or specify a template. Available template values: Name (Model Name), Version (Model Version), RandomUUID. Examples: myservice:123, {{ Name }}:{{ Version }}</td>
</tr>
<tr class="row-odd"><td>dockerfileBaseImage</td>
<td>string</td>
<td>python:3.6</td>
<td>False</td>
<td>Base image for Dockerfile</td>
</tr>
<tr class="row-even"><td>dockerfileAddCondaInstallation</td>
<td>boolean</td>
<td>True</td>
<td>False</td>
<td>Add conda installation code to Dockerfile</td>
</tr>
<tr class="row-odd"><td>dockerfileCondaEnvsLocation</td>
<td>string</td>
<td>/opt/conda/envs/</td>
<td>False</td>
<td>Conda env location in Dockerfile</td>
</tr>
</tbody>
</table>
<p>The packager provides the following list of result fields:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="14%" />
<col width="14%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>image</td>
<td>string</td>
<td>The full name of a built Docker image</td>
</tr>
</tbody>
</table>
<p>Let’s build a couple of examples of Docker CLI packager.
The packager requires <a class="reference internal" href="ref_connections.html#docker"><span class="std std-ref">docker</span></a> or <a class="reference internal" href="ref_connections.html#amazon-elastic-container-registry"><span class="std std-ref">ecr</span></a> connection types.
The following example assumes that you have created a connection with <cite>test-docker-registry</cite> id and <cite>gcr.io/project/odahuflow</cite> URI.</p>
<div class="literal-block-wrapper docutils container" id="minimal-example-of-docker-cli-packager-file">
<div class="code-block-caption"><span class="caption-text">Minimal Example of Docker CLI packager</span><a class="headerlink" href="#minimal-example-of-docker-cli-packager-file" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">id</span><span class="p">:</span> <span class="s">&quot;docker-cli-packager-example&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
    <span class="nt">integrationName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">docker-cli</span>
    <span class="nt">artifactName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wine-model-123456789.zip</span>
    <span class="nt">targets</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">connectionName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-docker-registry</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">docker-push</span>
</pre></div>
</div>
</div>
<p>Then a result of the packager will be something like this: “gcr.io/project/odahuflow/wine-0-1:ec1bf1cd-216d-4f0a-a62f-bf084c79c58c”.</p>
<p>Now, let’s try to change the docker image name and the base image.</p>
<div class="literal-block-wrapper docutils container" id="docker-cli-packager-with-custom-arguments-file">
<div class="code-block-caption"><span class="caption-text">Docker CLI packager with custom arguments</span><a class="headerlink" href="#docker-cli-packager-with-custom-arguments-file" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">id</span><span class="p">:</span> <span class="s">&quot;docker-cli-packager-example&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
    <span class="nt">integrationName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">docker-cli</span>
    <span class="nt">artifactName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wine-model-123456789.zip</span>
    <span class="nt">targets</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">connectionName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-docker-registry</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">docker-push</span>
    <span class="nt">arguments</span><span class="p">:</span>
        <span class="nt">imageName</span><span class="p">:</span> <span class="s">&quot;wine-test:prefix-{{</span><span class="nv"> </span><span class="s">RandomUUID</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">dockerfileBaseImage</span><span class="p">:</span> <span class="s">&quot;python:3.7&quot;</span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>odahuflowctl pack get --id <span class="s2">&quot;docker-cli-packager-example&quot;</span> -o <span class="s1">&#39;jsonpath=$[0].status.results[0].value&#39;</span>
</pre></div>
</div>
<p>Then a result of the packager will be something like this: “gcr.io/project/odahuflow/wine-test:prefix-ec1bf1cd-216d-4f0a-a62f-bf084c79c58c”.</p>
<p>You can run the image locally using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -it --rm --net host gcr.io/project/odahuflow/wine-test:prefix-ec1bf1cd-216d-4f0a-a62f-bf084c79c58c --help
</pre></div>
</div>
<p>The model CLI provides two commands:</p>
<blockquote>
<div><ul class="simple">
<li><cite>predict</cite> - Make predictions using GPPI model</li>
<li><cite>info</cite> - Show model input/output data schema</li>
</ul>
</div></blockquote>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Docker CLI info command</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -it --rm --net host gcr.io/project/odahuflow/wine-test:prefix-ec1bf1cd-216d-4f0a-a62f-bf084c79c58c info
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Docker CLI info command output</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Input schema:
{
    &quot;columns&quot;: {
        &quot;example&quot;: [
            &quot;features&quot;,
            &quot;features&quot;,
            &quot;features&quot;,
        ],
        &quot;items&quot;: {
            &quot;type&quot;: &quot;string&quot;
        },
        &quot;type&quot;: &quot;array&quot;
    },
    &quot;data&quot;: {
        &quot;items&quot;: {
            &quot;items&quot;: {
                &quot;type&quot;: &quot;number&quot;
            },
            &quot;type&quot;: &quot;array&quot;
        },
        &quot;type&quot;: &quot;array&quot;,
        &quot;example&quot;: [
            [
                0,
                0,
                0,
            ]
        ]
    }
}
Output schema:
{
    &quot;prediction&quot;: {
        &quot;example&quot;: [
            [
                0
            ]
        ],
        &quot;items&quot;: {
            &quot;type&quot;: &quot;number&quot;
        },
        &quot;type&quot;: &quot;array&quot;
    },
    &quot;columns&quot;: {
        &quot;example&quot;: [
            &quot;predictions&quot;
        ],
        &quot;items&quot;: {
            &quot;type&quot;: &quot;string&quot;
        },
        &quot;type&quot;: &quot;array&quot;
    }
}
</pre></div>
</div>
</div>
<p>Let’s make a batch prediction.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Create a predict file</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir volume
cat &gt; volume/predicts.json <span class="s">&lt;&lt;EOL</span>
<span class="s">{</span>
<span class="s">  &quot;columns&quot;: [</span>
<span class="s">    &quot;features&quot;,</span>
<span class="s">    &quot;features&quot;,</span>
<span class="s">    &quot;features&quot;,</span>
<span class="s">  ],</span>
<span class="s">  &quot;data&quot;: [</span>
<span class="s">    [</span>
<span class="s">      1,</span>
<span class="s">      2,</span>
<span class="s">      3</span>
<span class="s">    ],</span>
<span class="s">    [</span>
<span class="s">      4,</span>
<span class="s">      5,</span>
<span class="s">      6</span>
<span class="s">    ]</span>
<span class="s">  ]</span>
<span class="s">}</span>
<span class="s">EOL</span>
docker run -it --rm --net -v volume:/volume host gcr.io/project/odahuflow/wine-test:prefix-ec1bf1cd-216d-4f0a-a62f-bf084c79c58c predict /volume/predicts.json /volume
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Result of prediction</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat volumes/result.json
<span class="o">{</span>
  <span class="s2">&quot;prediction&quot;</span>: <span class="o">[</span>
    <span class="o">[</span>
      <span class="m">0</span>.09405578672885895
    <span class="o">]</span>,
    <span class="o">[</span>
      <span class="m">0</span>.01238546592343845
    <span class="o">]</span>
  <span class="o">]</span>,
  <span class="s2">&quot;columns&quot;</span>: <span class="o">[</span>
    <span class="s2">&quot;predictions&quot;</span>
  <span class="o">]</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ref_deployments.html" class="btn btn-neutral float-right" title="Model Deployments" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ref_trainings.html" class="btn btn-neutral" title="Model Trainings" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Odahu Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.0-rc27',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>