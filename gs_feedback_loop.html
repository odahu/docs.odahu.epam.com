

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Feedback loop &mdash; Odahu 1.0.0-rc27 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Odahu
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="about.html">About Odahu</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="gen_distros.html">Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="gen_security.html">Security</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials_wine.html">MLFlow</a></li>
</ul>
<p class="caption"><span class="caption-text">Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="comp_api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="comp_operator.html">Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="comp_mlflow_trainer.html">MLFlow Trainer</a></li>
<li class="toctree-l1"><a class="reference internal" href="comp_model_feedback.html">Model Feedback</a></li>
</ul>
<p class="caption"><span class="caption-text">Integrations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="int_metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="int_airflow.html">Airflow</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ref_kubernetes.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref_model_format.html">Model Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref_networking.html">Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="gen_glossary.html">Glossary</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dev_general.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_project_structure.html">A repository directory structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_project_structure.html#repositories">Repositories</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_hints.html">Development hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_testing.html">Integration Testing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Odahu</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Feedback loop</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/gs_feedback_loop.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="feedback-loop">
<h1>Feedback loop<a class="headerlink" href="#feedback-loop" title="Permalink to this headline">¶</a></h1>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Described below requires <code class="docutils literal notranslate"><span class="pre">feedback</span></code> to be enabled in the HELM’s chart configuration during deploy.</p>
</div>
<p>Feedback loop allows model’s developers to get review how good models work from their users (3rd-party systems or users that ask for prediction).</p>
<ol class="arabic simple">
<li>When anybody asks model for prediction, <code class="docutils literal notranslate"><span class="pre">Request-ID</span></code> header with random generated value is added to request and response.</li>
<li>Generating of new value for <code class="docutils literal notranslate"><span class="pre">Request-ID</span></code> header is missing if value is present by requester (in request headers).</li>
<li>Request and response of the model are being stored on external storage service (such as AWS S3 or GCS, depending on configuration).</li>
<li>Later, when feedback about prediction could be made (e.g. action, that is predicted, appeared), another HTTP request should be sent.</li>
<li>All feedbacks are persisted on external storage service (depending on configuration) and can be used by models during next (re-) training phase (automatically, without any manual actions).</li>
</ol>
<div class="section" id="feedback-loop-protocol">
<h2>Feedback loop protocol<a class="headerlink" href="#feedback-loop-protocol" title="Permalink to this headline">¶</a></h2>
<p>As said before, in general, feedback loop consists of two steps:</p>
<ol class="arabic simple">
<li>Creation of prediction (with/without <code class="docutils literal notranslate"><span class="pre">request-id</span></code> defined in request)</li>
<li>Persisting of feedback (with <code class="docutils literal notranslate"><span class="pre">request-id</span></code> returned from previous step)</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In examples below <strong>BASE_URL</strong>, <strong>ROUTE</strong> and <strong>JWT</strong> env variables are used. These variables should be set before execution of these chunks of code and they
must point to existed EDGE endpoint, existed route name and use valid JWT token with appropriate role.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For sending of feedback JWT with any role name might be used.</p>
</div>
<div class="section" id="create-a-prediction-without-specific-request-id-provided">
<h3>Create a prediction without specific request id provided<a class="headerlink" href="#create-a-prediction-without-specific-request-id-provided" title="Permalink to this headline">¶</a></h3>
<p>Request to EDGE endpoint for prediction, that does not contain <code class="docutils literal notranslate"><span class="pre">request-id</span></code> header.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">vv</span> <span class="s2">&quot;$</span><span class="si">{BASE_URL}</span><span class="s2">/model/$</span><span class="si">{ROUTE}</span><span class="s2">/api/model/invoke&quot;</span> \
<span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $</span><span class="si">{JWT}</span><span class="s2">&quot;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;age=35&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;capital-gain=14084&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;capital-loss=0&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;education=Bachelors&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;education-num=13&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;fnlwgt=77516&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;hours-per-week=40&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;marital-status=Married-civ-spouse&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;native-country=United-States&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;occupation=Exec-managerial&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;race=White&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;relationship=Not-in-family&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;sex=Male&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;workclass=Private&#39;</span>
</pre></div>
</div>
<p>Response contains generated <code class="docutils literal notranslate"><span class="pre">request-id</span></code> header.</p>
<p>These requests and responses are being persisted on external storage (e.g. on S3) in two files.</p>
<p>First file contains meta information about request and response (name is like <code class="docutils literal notranslate"><span class="pre">/request_response/income/1.1/year=2019/month=07/day=24/2019072414_4.json</span></code>) in next format.</p>
<div class="code json highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="s2">&quot;85252432-8d26-9b5f-bed3-e9ceeafc688c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;request_get_args&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;response_status&quot;</span><span class="p">:</span> <span class="s2">&quot;200&quot;</span><span class="p">,</span>
    <span class="s2">&quot;request_host&quot;</span><span class="p">:</span> <span class="s2">&quot;edge.odahu-test.ailifecycle.org&quot;</span><span class="p">,</span>
    <span class="s2">&quot;model_endpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="s2">&quot;model_version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;request_http_method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
    <span class="s2">&quot;request_http_headers&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;:scheme&quot;</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span>
        <span class="s2">&quot;accept&quot;</span><span class="p">:</span> <span class="s2">&quot;*/*&quot;</span><span class="p">,</span>
        <span class="s2">&quot;knative-serving-namespace&quot;</span><span class="p">:</span> <span class="s2">&quot;odahu&quot;</span><span class="p">,</span>
        <span class="s2">&quot;:authority&quot;</span><span class="p">:</span> <span class="s2">&quot;edge.odahu-test.ailifecycle.org&quot;</span><span class="p">,</span>
        <span class="s2">&quot;:path&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/model/invoke&quot;</span><span class="p">,</span>
        <span class="s2">&quot;:method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;user-agent&quot;</span><span class="p">:</span> <span class="s2">&quot;python-requests/2.22.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x-b3-traceid&quot;</span><span class="p">:</span> <span class="s2">&quot;1bd630537a9a54c9d3997150ca540d01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x-request-id&quot;</span><span class="p">:</span> <span class="s2">&quot;85252432-8d26-9b5f-bed3-e9ceeafc688c&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x-b3-sampled&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x-envoy-external-address&quot;</span><span class="p">:</span> <span class="s2">&quot;1.1.1.1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x-forwarded-host&quot;</span><span class="p">:</span> <span class="s2">&quot;edge.odahu-test.ailifecycle.org&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x-original-uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/model/sklearn-income/api/model/invoke&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x-forwarded-port&quot;</span><span class="p">:</span> <span class="s2">&quot;443&quot;</span><span class="p">,</span>
        <span class="s2">&quot;accept-encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;knative-serving-revision&quot;</span><span class="p">:</span> <span class="s2">&quot;sklearn-income-5jrrp&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x-envoy-original-path&quot;</span><span class="p">:</span> <span class="s2">&quot;/model/sklearn-income/api/model/invoke&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x-real-ip&quot;</span><span class="p">:</span> <span class="s2">&quot;1.1.1.1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x-envoy-decorator-operation&quot;</span><span class="p">:</span> <span class="s2">&quot;sklearn-income-5jrrp.odahu.svc.cluster.local:80/model/sklearn-income/api*&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x-istio-attributes&quot;</span><span class="p">:</span> <span class="s2">&quot;CksKGGRlc3RpbmF0aW9uLnNlcnZpY2UuaG9zdBIvEi1za2xlYXJuLWluY29tZS01anJycC5sZWdpb24uc3ZjLmNsdXN0ZXIubG9jYWwKSQoXZGVzdGluYXRpb24uc2VydmljZS51aWQSLhIsaXN0aW86Ly9sZWdpb24vc2VydmljZXMvc2tsZWFybi1pbmNvbWUtNWpycnAKMgoYZGVzdGluYXRpb24uc2VydmljZS5uYW1lEhYSFHNrbGVhcm4taW5jb21lLTVqcnJwCikKHWRlc3RpbmF0aW9uLnNlcnZpY2UubmFtZXNwYWNlEggSBmxlZ2lvbgpPCgpzb3VyY2UudWlkEkESP2t1YmVybmV0ZXM6Ly9pc3Rpby1pbmdyZXNzZ2F0ZXdheS02ODVkOTY0OWZkLXRjcmx2LmlzdGlvLXN5c3RlbQ==&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x-forwarded-for&quot;</span><span class="p">:</span> <span class="s2">&quot;1.1.1.1,1.1.1.1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content-length&quot;</span><span class="p">:</span> <span class="s2">&quot;257&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x-forwarded-proto&quot;</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x-scheme&quot;</span><span class="p">:</span> <span class="s2">&quot;https&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x-b3-spanid&quot;</span><span class="p">:</span> <span class="s2">&quot;d3997150ca540d01&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;request_post_args&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;native-country&quot;</span><span class="p">:</span> <span class="s2">&quot;United-States&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sex&quot;</span><span class="p">:</span> <span class="s2">&quot;Male&quot;</span><span class="p">,</span>
        <span class="s2">&quot;education&quot;</span><span class="p">:</span> <span class="s2">&quot;Bachelors&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hours-per-week&quot;</span><span class="p">:</span> <span class="s2">&quot;40&quot;</span><span class="p">,</span>
        <span class="s2">&quot;workclass&quot;</span><span class="p">:</span> <span class="s2">&quot;Private&quot;</span><span class="p">,</span>
        <span class="s2">&quot;race&quot;</span><span class="p">:</span> <span class="s2">&quot;White&quot;</span><span class="p">,</span>
        <span class="s2">&quot;relationship&quot;</span><span class="p">:</span> <span class="s2">&quot;Husband&quot;</span><span class="p">,</span>
        <span class="s2">&quot;marital-status&quot;</span><span class="p">:</span> <span class="s2">&quot;Married-civ-spouse&quot;</span><span class="p">,</span>
        <span class="s2">&quot;occupation&quot;</span><span class="p">:</span> <span class="s2">&quot;Exec-managerial&quot;</span><span class="p">,</span>
        <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="s2">&quot;35&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fnlwgt&quot;</span><span class="p">:</span> <span class="s2">&quot;77516&quot;</span><span class="p">,</span>
        <span class="s2">&quot;capital-gain&quot;</span><span class="p">:</span> <span class="s2">&quot;14084&quot;</span><span class="p">,</span>
        <span class="s2">&quot;capital-loss&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;education-num&quot;</span><span class="p">:</span> <span class="s2">&quot;13&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;request_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/model/sklearn-income/api/model/invoke&quot;</span><span class="p">,</span>
    <span class="s2">&quot;response_http_headers&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model-endpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model-name&quot;</span><span class="p">:</span> <span class="s2">&quot;income&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model-version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="s2">&quot;istio-envoy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;:status&quot;</span><span class="p">:</span> <span class="s2">&quot;200&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content-length&quot;</span><span class="p">:</span> <span class="s2">&quot;18&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x-envoy-upstream-service-time&quot;</span><span class="p">:</span> <span class="s2">&quot;67&quot;</span><span class="p">,</span>
        <span class="s2">&quot;connection&quot;</span><span class="p">:</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span>
        <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;Wed, 24 Jul 2019 14:53:55 GMT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request-id&quot;</span><span class="p">:</span> <span class="s2">&quot;85252432-8d26-9b5f-bed3-e9ceeafc688c&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="s2">&quot;income&quot;</span><span class="p">,</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-07-24 14:53:55 +0000&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Second file contains response chunks with same <code class="docutils literal notranslate"><span class="pre">request-id</span></code> (name is like <code class="docutils literal notranslate"><span class="pre">/response_body/income/1.1/year=2019/month=07/day=24/2019072414_1.json</span></code>) in next format:</p>
<div class="code json highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="s2">&quot;85252432-8d26-9b5f-bed3-e9ceeafc688c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;model_endpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="s2">&quot;model_version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="s2">&quot;income&quot;</span><span class="p">,</span>
    <span class="s2">&quot;response_content&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="se">\n</span><span class="s2">  </span><span class="se">\&quot;</span><span class="s2">result</span><span class="se">\&quot;</span><span class="s2">: 1</span><span class="se">\n</span><span class="s2">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-07-24 14:03:00 +0000&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-prediction-with-specific-request-id-provided">
<h3>Create a prediction with specific request id provided<a class="headerlink" href="#create-a-prediction-with-specific-request-id-provided" title="Permalink to this headline">¶</a></h3>
<p>Request to EDGE endpoint for prediction, that contains <code class="docutils literal notranslate"><span class="pre">request-id</span></code> header.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">vv</span> <span class="s2">&quot;$</span><span class="si">{BASE_URL}</span><span class="s2">/model/$</span><span class="si">{ROUTE}</span><span class="s2">/api/model/invoke&quot;</span> \
<span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $</span><span class="si">{JWT}</span><span class="s2">&quot;</span> \
<span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Request-ID: my-example-request-id&quot;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;age=35&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;capital-gain=14084&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;capital-loss=0&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;education=Bachelors&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;education-num=13&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;fnlwgt=77516&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;hours-per-week=40&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;marital-status=Married-civ-spouse&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;native-country=United-States&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;occupation=Exec-managerial&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;race=White&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;relationship=Not-in-family&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;sex=Male&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;workclass=Private&#39;</span>
</pre></div>
</div>
<p>Response contains sent <code class="docutils literal notranslate"><span class="pre">request-id</span></code> header.</p>
<p>These requests and responses are being persisted on external storage (e.g. on S3) as in a previous case.</p>
</div>
<div class="section" id="send-feedback-for-prediction-using-json-payload">
<h3>Send feedback for prediction using JSON payload<a class="headerlink" href="#send-feedback-for-prediction-using-json-payload" title="Permalink to this headline">¶</a></h3>
<p>Request to EDGE endpoint for saving <em>feedback</em> of previous made prediction for model <strong>income</strong> version <strong>1.1</strong> with id <strong>previous-prediction-id</strong>.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">vv</span> <span class="s2">&quot;$</span><span class="si">{BASE_URL}</span><span class="s2">/feedback/model/&quot;</span> \
<span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $</span><span class="si">{JWT}</span><span class="s2">&quot;</span> \
<span class="o">-</span><span class="n">H</span> <span class="s2">&quot;x-model-name: income&quot;</span> \
<span class="o">-</span><span class="n">H</span> <span class="s2">&quot;x-model-version: 1.1&quot;</span> \
<span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Request-ID: previous-prediction-id&quot;</span> \
<span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Content-Type: application/json&#39;</span> \
<span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;truthful&quot;: 1}&#39;</span>
</pre></div>
</div>
<p>HTTP response code 200 should be returned if request has been parsed and has been sent to storage.</p>
<p>Also, next JSON structure should be returned:</p>
<ul class="simple">
<li>Field <code class="docutils literal notranslate"><span class="pre">error</span></code> equals to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</li>
<li>Field <code class="docutils literal notranslate"><span class="pre">registered</span></code> equals to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</li>
<li>Field <code class="docutils literal notranslate"><span class="pre">message</span></code> equals to data sent on storage.</li>
</ul>
<p>Non 200 HTTP code indicates about parsing / persisting / another error.</p>
<p>Example response</p>
<p>This <strong>feedback</strong> is being persisted on external storage (e.g. on S3) in partitioned file like <code class="docutils literal notranslate"><span class="pre">/feedback/income/1.1/year=2019/month=07/day=23/2019072311_2.json</span></code> in next format.</p>
<div class="code json highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="s2">&quot;previous-prediction-id&quot;</span><span class="p">,</span>
    <span class="s2">&quot;model_version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="s2">&quot;income&quot;</span><span class="p">,</span>
    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;json&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;truthful&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-07-23 12:40:16 +0000&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="send-feedback-for-prediction-using-url-parameters">
<h3>Send feedback for prediction using URL parameters<a class="headerlink" href="#send-feedback-for-prediction-using-url-parameters" title="Permalink to this headline">¶</a></h3>
<p>Request to EDGE endpoint for saving <em>feedback</em> of previous made prediction for model <strong>income</strong> version <strong>1.1</strong> with id <strong>previous-prediction-id</strong>.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">vv</span> <span class="s2">&quot;$</span><span class="si">{BASE_URL}</span><span class="s2">/feedback/model/?truthful=1&quot;</span> \
<span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $</span><span class="si">{JWT}</span><span class="s2">&quot;</span> \
<span class="o">-</span><span class="n">H</span> <span class="s2">&quot;x-model-name: income&quot;</span> \
<span class="o">-</span><span class="n">H</span> <span class="s2">&quot;x-model-version: 1.1&quot;</span> \
<span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Request-ID: previous-prediction-id&quot;</span>
</pre></div>
</div>
<p>Response</p>
<p>This <strong>feedback</strong> is being persisted on external storage (e.g. on S3) in partitioned file like <code class="docutils literal notranslate"><span class="pre">/feedback/income/1.1/year=2019/month=07/day=23/2019072311_2.json</span></code> in next format.</p>
<div class="code json highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="s2">&quot;previous-prediction-id&quot;</span><span class="p">,</span>
    <span class="s2">&quot;model_version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="s2">&quot;income&quot;</span><span class="p">,</span>
    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">XXXX</span>
    <span class="p">},</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-07-23 12:40:16 +0000&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Odahu Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.0-rc27',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>