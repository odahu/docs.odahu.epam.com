

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Airflow &mdash; Odahu 1.0.0-rc27 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="_static/nav_content_width.css" type="text/css" />
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="JupyterLab extension" href="int_jupyterlab_extension.html" />
    <link rel="prev" title="Metrics" href="int_metrics.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Odahu
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="about.html">About Open Data Analytics Hub (ODAHU)</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="gen_distros.html">Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="gen_security.html">Security</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials_installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials_wine.html">Cluster Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials_local_wine.html">Local Quickstart</a></li>
</ul>
<p class="caption"><span class="caption-text">Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="comp_api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="comp_operator.html">Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="comp_mlflow_trainer.html">MLFlow Trainer</a></li>
</ul>
<p class="caption"><span class="caption-text">Integrations</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="int_metrics.html">Metrics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Airflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#connections">Connections</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#odahu-flow-connection">Odahu-flow Connection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuring-the-connection">Configuring the Connection</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#custom-operators">Custom operators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#train-pack-deploy-operators">Train, Pack, Deploy operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-usage-operators">Model usage operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="#helper-operators">Helper operators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-describe-operators">How to describe operators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dag-example">DAG example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="int_jupyterlab_extension.html">JupyterLab extension</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ref_odahuflowctl.html">Odahuflowctl</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref_model_format.html">Model Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref_connections.html">Connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref_trainings.html">Model Trainings</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref_packagers.html">Model Packagers</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref_deployments.html">Model Deployments</a></li>
<li class="toctree-l1"><a class="reference internal" href="gen_glossary.html">Glossary</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dev_general.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_project_structure.html">A repository directory structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_project_structure.html#repositories">Repositories</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_project_structure.html#odahu-odahu-infra">odahu/odahu-infra</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_hints.html">Development hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_testing.html">Integration+ Testing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Odahu</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Airflow</li>
    
    
<li class="wy-breadcrumbs-aside">
<a href="odahu-docs.pdf">Get PDF version</a>
</li>

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="airflow">
<h1>Airflow<a class="headerlink" href="#airflow" title="Permalink to this headline">¶</a></h1>
<p>Odahu-flow provides a set of custom operators that allow you to interact with a Odahu cluster using <a class="reference external" href="https://airflow.apache.org/">Apache Airflow</a></p>
<div class="section" id="connections">
<h2>Connections<a class="headerlink" href="#connections" title="Permalink to this headline">¶</a></h2>
<p>The Airflow plugin should be authorized by Odahu. Authorization is implemented using regular <a class="reference external" href="https://airflow.apache.org/concepts.html#connections">Airflow Connections</a></p>
<p>All custom Odahu-flow operators accept <cite>api_connection_id</cite> as a parameter that refers to <cite>Odahu-flow Connection</cite></p>
<div class="section" id="odahu-flow-connection">
<h3>Odahu-flow Connection<a class="headerlink" href="#odahu-flow-connection" title="Permalink to this headline">¶</a></h3>
<p>The Odahu connection provides access to a Odahu cluster for Odahu custom operators.</p>
<div class="section" id="configuring-the-connection">
<h4>Configuring the Connection<a class="headerlink" href="#configuring-the-connection" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>Host (required)</dt>
<dd>The host to connect to. Usually available at: <cite>odahu.&lt;cluster-base-url&gt;</cite></dd>
<dt>Type (required)</dt>
<dd><cite>HTTP</cite></dd>
<dt>Schema (optional)</dt>
<dd><cite>https</cite></dd>
<dt>Login (required)</dt>
<dd>Specify the user name to connect.</dd>
<dt>Password (required)</dt>
<dd>Specify the password to connect.</dd>
<dt>Extra (optional)</dt>
<dd><p class="first">Specify the extra parameters (as json dictionary) that can be used in Odahu
connection. Because Odahu uses OpenID authorization, additional OpenID/OAuth 2.0 parameters may be supplied here.</p>
<p>The following parameters are supported and must be defined:</p>
<ul class="simple">
<li><strong>auth_url</strong>: url of <a class="reference external" href="https://tools.ietf.org/html/rfc6749#section-1.1">authorization server</a></li>
<li><strong>client_id</strong>: The client identifier issued to the client during the registration process. <a class="reference external" href="https://tools.ietf.org/html/rfc6749#section-2.3.1">See more</a></li>
<li><strong>client_secret</strong>: The client secret. The client MAY omit the parameter if the client secret is an empty string. <a class="reference external" href="https://tools.ietf.org/html/rfc6749#section-2.3.1">See more</a></li>
<li><strong>scope</strong>: <a class="reference external" href="https://tools.ietf.org/html/rfc6749#section-3.3">Access Token Scope</a></li>
</ul>
<p>Example “extras” field:</p>
<div class="last highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nt">&quot;auth_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://keycloak.&lt;my-app-domain&gt;&quot;</span><span class="p">,</span>
   <span class="nt">&quot;client_id&quot;</span><span class="p">:</span> <span class="s2">&quot;my-app&quot;</span><span class="p">,</span>
   <span class="nt">&quot;client_secret&quot;</span><span class="p">:</span> <span class="s2">&quot;*********&quot;</span><span class="p">,</span>
   <span class="nt">&quot;scope&quot;</span><span class="p">:</span> <span class="s2">&quot;openid profile email offline_access groups&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="custom-operators">
<h2>Custom operators<a class="headerlink" href="#custom-operators" title="Permalink to this headline">¶</a></h2>
<p>This chapter describes the custom operators provided by Odahu.</p>
<div class="section" id="train-pack-deploy-operators">
<h3>Train, Pack, Deploy operators<a class="headerlink" href="#train-pack-deploy-operators" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="TrainingOperator">
<em class="property">class </em><code class="descname">TrainingOperator</code><span class="sig-paren">(</span><em>training=None</em>, <em>api_connection_id=None</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#TrainingOperator" title="Permalink to this definition">¶</a></dt>
<dd><p>The operator that runs <a class="reference internal" href="gen_glossary.html#term-train"><span class="xref std std-term">Train</span></a> phase</p>
<p>Use <cite>args</cite> and <cite>kwargs</cite> to override other operator parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>training</strong> (<em>odahuflow.sdk.models.ModelTraining</em>) – describes the <a class="reference internal" href="gen_glossary.html#term-train"><span class="xref std std-term">Train</span></a> phase</li>
<li><strong>api_connection_id</strong> (<em>str</em>) – conn_id of <a class="reference internal" href="#odahu-flow-connection"><span class="std std-ref">Odahu-flow Connection</span></a></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="TrainingSensor">
<em class="property">class </em><code class="descname">TrainingSensor</code><span class="sig-paren">(</span><em>training_id=None</em>, <em>api_connection_id=None</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#TrainingSensor" title="Permalink to this definition">¶</a></dt>
<dd><p>The operator that waits for <a class="reference internal" href="gen_glossary.html#term-train"><span class="xref std std-term">Train</span></a> phase is finished</p>
<p>Use <cite>args</cite> and <cite>kwargs</cite> to override other operator parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>training_id</strong> (<em>str</em>) – <cite>Train</cite> id waits for</li>
<li><strong>api_connection_id</strong> (<em>str</em>) – conn_id of <a class="reference internal" href="#odahu-flow-connection"><span class="std std-ref">Odahu-flow Connection</span></a></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="PackagingOperator">
<em class="property">class </em><code class="descname">PackagingOperator</code><span class="sig-paren">(</span><em>packaging=None</em>, <em>api_connection_id=None</em>, <em>trained_task_id: str = &quot;&quot;</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#PackagingOperator" title="Permalink to this definition">¶</a></dt>
<dd><p>The operator that runs <a class="reference internal" href="gen_glossary.html#term-package"><span class="xref std std-term">Package</span></a> phase</p>
<p>Use <cite>args</cite> and <cite>kwargs</cite> to override other operator parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>packaging</strong> (<em>odahuflow.sdk.models.ModelPackaging</em>) – describes the <a class="reference internal" href="gen_glossary.html#term-package"><span class="xref std std-term">Package</span></a> phase</li>
<li><strong>api_connection_id</strong> (<em>str</em>) – conn_id of <a class="reference internal" href="#odahu-flow-connection"><span class="std std-ref">Odahu-flow Connection</span></a></li>
<li><strong>trained_task_id</strong> (<em>str</em>) – finished task id of TrainingSensor</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="PackagingSensor">
<em class="property">class </em><code class="descname">PackagingSensor</code><span class="sig-paren">(</span><em>training_id=None</em>, <em>api_connection_id=None</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#PackagingSensor" title="Permalink to this definition">¶</a></dt>
<dd><p>The operator that waits for <a class="reference internal" href="gen_glossary.html#term-package"><span class="xref std std-term">Package</span></a> phase is finished</p>
<p>Use <cite>args</cite> and <cite>kwargs</cite> to override other operator parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>packaging_id</strong> (<em>str</em>) – <cite>Package</cite> id waits for</li>
<li><strong>api_connection_id</strong> (<em>str</em>) – conn_id of <a class="reference internal" href="#odahu-flow-connection"><span class="std std-ref">Odahu-flow Connection</span></a></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="DeploymentOperator">
<em class="property">class </em><code class="descname">DeploymentOperator</code><span class="sig-paren">(</span><em>deployment=None</em>, <em>api_connection_id=None</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#DeploymentOperator" title="Permalink to this definition">¶</a></dt>
<dd><p>The operator that runs <a class="reference internal" href="gen_glossary.html#term-deploy"><span class="xref std std-term">Deploy</span></a> phase</p>
<p>Use <cite>args</cite> and <cite>kwargs</cite> to override other operator parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>packaging</strong> (<em>odahuflow.sdk.models.ModelDeployment</em>) – describes the <a class="reference internal" href="gen_glossary.html#term-deploy"><span class="xref std std-term">Deploy</span></a> phase</li>
<li><strong>api_connection_id</strong> (<em>str</em>) – conn_id of <a class="reference internal" href="#odahu-flow-connection"><span class="std std-ref">Odahu-flow Connection</span></a></li>
<li><strong>packaging_task_id</strong> (<em>str</em>) – finished task id of PackagingSensor</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="DeploymentSensor">
<em class="property">class </em><code class="descname">DeploymentSensor</code><span class="sig-paren">(</span><em>training_id=None</em>, <em>api_connection_id=None</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#DeploymentSensor" title="Permalink to this definition">¶</a></dt>
<dd><p>The operator that waits for <a class="reference internal" href="gen_glossary.html#term-deploy"><span class="xref std std-term">Deploy</span></a> phase is finished</p>
<p>Use <cite>args</cite> and <cite>kwargs</cite> to override other operator parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>deployment_id</strong> (<em>str</em>) – <cite>Deploy</cite> id waits for</li>
<li><strong>api_connection_id</strong> (<em>str</em>) – conn_id of <a class="reference internal" href="#odahu-flow-connection"><span class="std std-ref">Odahu-flow Connection</span></a></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="model-usage-operators">
<h3>Model usage operators<a class="headerlink" href="#model-usage-operators" title="Permalink to this headline">¶</a></h3>
<p>These operators are used to interact with deployed models.</p>
<dl class="class">
<dt id="ModelInfoRequestOperator">
<em class="property">class </em><code class="descname">ModelInfoRequestOperator</code><span class="sig-paren">(</span><em>self</em>, <em>model_deployment_name: str</em>, <em>api_connection_id: str</em>, <em>model_connection_id: str</em>, <em>md_role_name: str = &quot;&quot;</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ModelInfoRequestOperator" title="Permalink to this definition">¶</a></dt>
<dd><p>The operator what extract metadata of deployed model.</p>
<p>Use <cite>args</cite> and <cite>kwargs</cite> to override other operator parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>model_deployment_name</strong> (<em>str</em>) – Model deployment name</li>
<li><strong>api_connection_id</strong> (<em>str</em>) – conn_id of <a class="reference internal" href="#odahu-flow-connection"><span class="std std-ref">Odahu-flow Connection</span></a></li>
<li><strong>model_connection_id</strong> (<em>str</em>) – id of Odahu <a class="reference internal" href="gen_glossary.html#term-connection"><span class="xref std std-term">Connection</span></a> for deployed model access</li>
<li><strong>md_role_name</strong> (<em>str</em>) – Role name</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="ModelPredictRequestOperator">
<em class="property">class </em><code class="descname">ModelPredictRequestOperator</code><span class="sig-paren">(</span><em>self</em>, <em>model_deployment_name: str</em>, <em>api_connection_id: str</em>, <em>model_connection_id: str</em>, <em>request_body: typing.Any</em>, <em>md_role_name: str = &quot;&quot;</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ModelPredictRequestOperator" title="Permalink to this definition">¶</a></dt>
<dd><p>The operator request prediction using deployed model.</p>
<p>Use <cite>args</cite> and <cite>kwargs</cite> to override other operator parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>model_deployment_name</strong> (<em>str</em>) – &lt;paste&gt;</li>
<li><strong>api_connection_id</strong> (<em>str</em>) – conn_id of <a class="reference internal" href="#odahu-flow-connection"><span class="std std-ref">Odahu-flow Connection</span></a></li>
<li><strong>model_connection_id</strong> (<em>str</em>) – id of Odahu <a class="reference internal" href="gen_glossary.html#term-connection"><span class="xref std std-term">Connection</span></a> for deployed model access</li>
<li><strong>request_body</strong> (<em>dict</em>) – JSON Body with model parameters</li>
<li><strong>md_role_name</strong> (<em>str</em>) – Role name</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="helper-operators">
<h3>Helper operators<a class="headerlink" href="#helper-operators" title="Permalink to this headline">¶</a></h3>
<p>These operators are helpers to simplify using Odahu-flow.</p>
<dl class="class">
<dt id="GcpConnectionToOdahuConnectionOperator">
<em class="property">class </em><code class="descname">GcpConnectionToOdahuConnectionOperator</code><span class="sig-paren">(</span><em>self</em>, <em>api_connection_id: str</em>, <em>google_cloud_storage_conn_id: str</em>, <em>conn_template: typing.Any</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#GcpConnectionToOdahuConnectionOperator" title="Permalink to this definition">¶</a></dt>
<dd><p>Create Odahu-flow Connection using GCP Airflow Connection</p>
<p>Use <cite>args</cite> and <cite>kwargs</cite> to override other operator parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>api_connection_id</strong> (<em>str</em>) – conn_id of <a class="reference internal" href="#odahu-flow-connection"><span class="std std-ref">Odahu-flow Connection</span></a></li>
<li><strong>google_cloud_storage_conn_id</strong> (<em>str</em>) – conn_id to Gcp Connection</li>
<li><strong>conn_template</strong> (<em>odahuflow.sdk.models.connection.Connection</em>) – Odahu-flow Connection template</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<div class="section" id="how-to-describe-operators">
<h2>How to describe operators<a class="headerlink" href="#how-to-describe-operators" title="Permalink to this headline">¶</a></h2>
<p>When you initialize Odahu custom operators such as <code class="docutils literal notranslate"><span class="pre">TrainingOperator</span></code>, <code class="docutils literal notranslate"><span class="pre">PackagingOperator</span></code>, or
<code class="docutils literal notranslate"><span class="pre">DeploymentOperator</span></code> you should pass odahu resource payload as a parameter.</p>
<p>Actually, this is payload that describes a resource that will be created at Odahu-flow cluster. You should describe
such payloads using odahuflow.sdk models</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Creating training payload</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">training</span> <span class="o">=</span> <span class="n">ModelTraining</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="n">training_id</span><span class="p">,</span>
    <span class="n">spec</span><span class="o">=</span><span class="n">ModelTrainingSpec</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">ModelIdentity</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;wine&quot;</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span>
        <span class="p">),</span>
        <span class="n">toolchain</span><span class="o">=</span><span class="s2">&quot;mlflow&quot;</span><span class="p">,</span>
        <span class="n">entrypoint</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">,</span>
        <span class="n">work_dir</span><span class="o">=</span><span class="s2">&quot;mlflow/sklearn/wine&quot;</span><span class="p">,</span>
        <span class="n">hyper_parameters</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span>
        <span class="p">},</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[</span>
            <span class="n">DataBindingDir</span><span class="p">(</span>
                <span class="n">conn_name</span><span class="o">=</span><span class="s1">&#39;wine&#39;</span><span class="p">,</span>
                <span class="n">local_path</span><span class="o">=</span><span class="s1">&#39;mlflow/sklearn/wine/wine-quality.csv&#39;</span>
            <span class="p">),</span>
        <span class="p">],</span>
        <span class="n">resources</span><span class="o">=</span><span class="n">ResourceRequirements</span><span class="p">(</span>
            <span class="n">requests</span><span class="o">=</span><span class="n">ResourceList</span><span class="p">(</span>
                <span class="n">cpu</span><span class="o">=</span><span class="s2">&quot;2024m&quot;</span><span class="p">,</span>
                <span class="n">memory</span><span class="o">=</span><span class="s2">&quot;2024Mi&quot;</span>
            <span class="p">),</span>
            <span class="n">limits</span><span class="o">=</span><span class="n">ResourceList</span><span class="p">(</span>
                <span class="n">cpu</span><span class="o">=</span><span class="s2">&quot;2024m&quot;</span><span class="p">,</span>
                <span class="n">memory</span><span class="o">=</span><span class="s2">&quot;2024Mi&quot;</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">vcs_name</span><span class="o">=</span><span class="s2">&quot;odahu-flow-examples&quot;</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>But if you did some RnD work with Odahu-flow previously, it’s likely that you already have yaml/json files that
describe the same payloads. You can reuse them to create odahuflow.sdk models automatically</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Using plain yaml/json text</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">odahuflow.airflow.resources</span> <span class="kn">import</span> <span class="n">resource</span>

<span class="n">packaging_id</span><span class="p">,</span> <span class="n">packaging</span> <span class="o">=</span> <span class="n">resource</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">id: airlfow-wine</span>
<span class="s2">kind: ModelPackaging</span>
<span class="s2">spec:</span>
<span class="s2">  artifactName: &quot;&lt;fill-in&gt;&quot;</span>
<span class="s2">  targets:</span>
<span class="s2">    - connectionName: docker-ci</span>
<span class="s2">      name: docker-push</span>
<span class="s2">  integrationName: docker-rest</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Or refer to yaml/json files that must be located at Airflow DAGs folder or Airflow Home folder (these folders are
configured at airflow.cfg file)</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Creating training payload</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">odahuflow.airflow.resources</span> <span class="kn">import</span> <span class="n">resource</span>
<span class="n">training_id</span><span class="p">,</span> <span class="n">training</span> <span class="o">=</span> <span class="n">resource</span><span class="p">(</span><span class="s1">&#39;training.odahuflow.yaml&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In this file, we refer to file <cite>training.odahuflow.yaml</cite> that is located at airflow dag’s folder</p>
<p>For example, if you use <a class="reference external" href="https://cloud.google.com/composer/">Google Cloud Composer</a> then you can locate your yamls inside DAGs bucket and refer to them by
relative path:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gsutil</span> <span class="n">cp</span> <span class="o">~/.</span><span class="n">training</span><span class="o">.</span><span class="n">odahuflow</span><span class="o">.</span><span class="n">yaml</span> <span class="n">gs</span><span class="p">:</span><span class="o">//&lt;</span><span class="n">your</span><span class="o">-</span><span class="n">composer</span><span class="o">-</span><span class="n">dags</span><span class="o">-</span><span class="n">bucket</span><span class="o">&gt;/</span>
</pre></div>
</div>
<div class="section" id="dag-example">
<h3>DAG example<a class="headerlink" href="#dag-example" title="Permalink to this headline">¶</a></h3>
<p>The example of the DAG that uses custom Odahu-flow operators is shown below. Four DAGs are described.</p>
<div class="literal-block-wrapper docutils container" id="usage-example">
<div class="code-block-caption"><span class="caption-text">dag.py</span><a class="headerlink" href="#usage-example" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">airflow</span> <span class="kn">import</span> <span class="n">DAG</span>
<span class="kn">from</span> <span class="nn">airflow.contrib.operators.gcs_to_gcs</span> <span class="kn">import</span> <span class="n">GoogleCloudStorageToGoogleCloudStorageOperator</span>
<span class="kn">from</span> <span class="nn">airflow.models</span> <span class="kn">import</span> <span class="n">Variable</span>
<span class="kn">from</span> <span class="nn">airflow.operators.bash_operator</span> <span class="kn">import</span> <span class="n">BashOperator</span>
<span class="kn">from</span> <span class="nn">odahuflow.sdk.models</span> <span class="kn">import</span> <span class="n">ModelTraining</span><span class="p">,</span> <span class="n">ModelTrainingSpec</span><span class="p">,</span> <span class="n">ModelIdentity</span><span class="p">,</span> <span class="n">ResourceRequirements</span><span class="p">,</span> <span class="n">ResourceList</span><span class="p">,</span> \
    <span class="n">ModelPackaging</span><span class="p">,</span> <span class="n">ModelPackagingSpec</span><span class="p">,</span> <span class="n">Target</span><span class="p">,</span> <span class="n">ModelDeployment</span><span class="p">,</span> <span class="n">ModelDeploymentSpec</span><span class="p">,</span> <span class="n">Connection</span><span class="p">,</span> <span class="n">ConnectionSpec</span><span class="p">,</span> \
    <span class="n">DataBindingDir</span>

<span class="kn">from</span> <span class="nn">odahuflow.airflow.connection</span> <span class="kn">import</span> <span class="n">GcpConnectionToOdahuConnectionOperator</span>
<span class="kn">from</span> <span class="nn">odahuflow.airflow.deployment</span> <span class="kn">import</span> <span class="n">DeploymentOperator</span><span class="p">,</span> <span class="n">DeploymentSensor</span>
<span class="kn">from</span> <span class="nn">odahuflow.airflow.model</span> <span class="kn">import</span> <span class="n">ModelPredictRequestOperator</span><span class="p">,</span> <span class="n">ModelInfoRequestOperator</span>
<span class="kn">from</span> <span class="nn">odahuflow.airflow.packaging</span> <span class="kn">import</span> <span class="n">PackagingOperator</span><span class="p">,</span> <span class="n">PackagingSensor</span>
<span class="kn">from</span> <span class="nn">odahuflow.airflow.training</span> <span class="kn">import</span> <span class="n">TrainingOperator</span><span class="p">,</span> <span class="n">TrainingSensor</span>

<span class="n">default_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;owner&#39;</span><span class="p">:</span> <span class="s1">&#39;airflow&#39;</span><span class="p">,</span>
    <span class="s1">&#39;depends_on_past&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;start_date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
    <span class="s1">&#39;email_on_failure&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;email_on_retry&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;end_date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2099</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">api_connection_id</span> <span class="o">=</span> <span class="s2">&quot;odahuflow_api&quot;</span>
<span class="n">model_connection_id</span> <span class="o">=</span> <span class="s2">&quot;odahuflow_model&quot;</span>

<span class="n">gcp_project</span> <span class="o">=</span> <span class="n">Variable</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;GCP_PROJECT&quot;</span><span class="p">)</span>
<span class="n">wine_bucket</span> <span class="o">=</span> <span class="n">Variable</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;WINE_BUCKET&quot;</span><span class="p">)</span>

<span class="n">wine_conn_id</span> <span class="o">=</span> <span class="s2">&quot;wine&quot;</span>
<span class="n">wine</span> <span class="o">=</span> <span class="n">Connection</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="n">wine_conn_id</span><span class="p">,</span>
    <span class="n">spec</span><span class="o">=</span><span class="n">ConnectionSpec</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;gcs&quot;</span><span class="p">,</span>
        <span class="n">uri</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;gs://</span><span class="si">{wine_bucket}</span><span class="s1">/data/wine-quality.csv&#39;</span><span class="p">,</span>
        <span class="n">region</span><span class="o">=</span><span class="n">gcp_project</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">training_id</span> <span class="o">=</span> <span class="s2">&quot;airlfow-wine&quot;</span>
<span class="n">training</span> <span class="o">=</span> <span class="n">ModelTraining</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="n">training_id</span><span class="p">,</span>
    <span class="n">spec</span><span class="o">=</span><span class="n">ModelTrainingSpec</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">ModelIdentity</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;wine&quot;</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span>
        <span class="p">),</span>
        <span class="n">toolchain</span><span class="o">=</span><span class="s2">&quot;mlflow&quot;</span><span class="p">,</span>
        <span class="n">entrypoint</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">,</span>
        <span class="n">work_dir</span><span class="o">=</span><span class="s2">&quot;mlflow/sklearn/wine&quot;</span><span class="p">,</span>
        <span class="n">hyper_parameters</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span>
        <span class="p">},</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[</span>
            <span class="n">DataBindingDir</span><span class="p">(</span>
                <span class="n">conn_name</span><span class="o">=</span><span class="s1">&#39;wine&#39;</span><span class="p">,</span>
                <span class="n">local_path</span><span class="o">=</span><span class="s1">&#39;mlflow/sklearn/wine/wine-quality.csv&#39;</span>
            <span class="p">),</span>
        <span class="p">],</span>
        <span class="n">resources</span><span class="o">=</span><span class="n">ResourceRequirements</span><span class="p">(</span>
            <span class="n">requests</span><span class="o">=</span><span class="n">ResourceList</span><span class="p">(</span>
                <span class="n">cpu</span><span class="o">=</span><span class="s2">&quot;2024m&quot;</span><span class="p">,</span>
                <span class="n">memory</span><span class="o">=</span><span class="s2">&quot;2024Mi&quot;</span>
            <span class="p">),</span>
            <span class="n">limits</span><span class="o">=</span><span class="n">ResourceList</span><span class="p">(</span>
                <span class="n">cpu</span><span class="o">=</span><span class="s2">&quot;2024m&quot;</span><span class="p">,</span>
                <span class="n">memory</span><span class="o">=</span><span class="s2">&quot;2024Mi&quot;</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">vcs_name</span><span class="o">=</span><span class="s2">&quot;odahu-flow-examples&quot;</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">packaging_id</span> <span class="o">=</span> <span class="s2">&quot;airlfow-wine&quot;</span>
<span class="n">packaging</span> <span class="o">=</span> <span class="n">ModelPackaging</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="n">packaging_id</span><span class="p">,</span>
    <span class="n">spec</span><span class="o">=</span><span class="n">ModelPackagingSpec</span><span class="p">(</span>
        <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">Target</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;docker-push&quot;</span><span class="p">,</span> <span class="n">connection_name</span><span class="o">=</span><span class="s2">&quot;docker-ci&quot;</span><span class="p">)],</span>
        <span class="n">integration_name</span><span class="o">=</span><span class="s2">&quot;docker-rest&quot;</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">deployment_id</span> <span class="o">=</span> <span class="s2">&quot;airlfow-wine&quot;</span>
<span class="n">deployment</span> <span class="o">=</span> <span class="n">ModelDeployment</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="n">deployment_id</span><span class="p">,</span>
    <span class="n">spec</span><span class="o">=</span><span class="n">ModelDeploymentSpec</span><span class="p">(</span>
        <span class="n">min_replicas</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">model_example_request</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alcohol&quot;</span><span class="p">,</span> <span class="s2">&quot;chlorides&quot;</span><span class="p">,</span> <span class="s2">&quot;citric acid&quot;</span><span class="p">,</span> <span class="s2">&quot;density&quot;</span><span class="p">,</span> <span class="s2">&quot;fixed acidity&quot;</span><span class="p">,</span> <span class="s2">&quot;free sulfur dioxide&quot;</span><span class="p">,</span> <span class="s2">&quot;pH&quot;</span><span class="p">,</span>
                <span class="s2">&quot;residual sugar&quot;</span><span class="p">,</span> <span class="s2">&quot;sulphates&quot;</span><span class="p">,</span> <span class="s2">&quot;total sulfur dioxide&quot;</span><span class="p">,</span> <span class="s2">&quot;volatile acidity&quot;</span><span class="p">],</span>
    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mf">12.8</span><span class="p">,</span> <span class="mf">0.029</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mf">6.2</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mf">3.33</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.39</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mf">0.66</span><span class="p">],</span>
             <span class="p">[</span><span class="mf">12.8</span><span class="p">,</span> <span class="mf">0.029</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mf">6.2</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mf">3.33</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.39</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mf">0.66</span><span class="p">]]</span>
<span class="p">}</span>

<span class="n">dag</span> <span class="o">=</span> <span class="n">DAG</span><span class="p">(</span>
    <span class="s1">&#39;wine_model&#39;</span><span class="p">,</span>
    <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span><span class="p">,</span>
    <span class="n">schedule_interval</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">dag</span><span class="p">:</span>
    <span class="n">data_extraction</span> <span class="o">=</span> <span class="n">GoogleCloudStorageToGoogleCloudStorageOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s1">&#39;data_extraction&#39;</span><span class="p">,</span>
        <span class="n">google_cloud_storage_conn_id</span><span class="o">=</span><span class="s1">&#39;wine_input&#39;</span><span class="p">,</span>
        <span class="n">source_bucket</span><span class="o">=</span><span class="n">wine_bucket</span><span class="p">,</span>
        <span class="n">destination_bucket</span><span class="o">=</span><span class="n">wine_bucket</span><span class="p">,</span>
        <span class="n">source_object</span><span class="o">=</span><span class="s1">&#39;input/*.csv&#39;</span><span class="p">,</span>
        <span class="n">destination_object</span><span class="o">=</span><span class="s1">&#39;data/&#39;</span><span class="p">,</span>
        <span class="n">project_id</span><span class="o">=</span><span class="n">gcp_project</span><span class="p">,</span>
        <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span>
    <span class="p">)</span>
    <span class="n">data_transformation</span> <span class="o">=</span> <span class="n">BashOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s1">&#39;data_transformation&#39;</span><span class="p">,</span>
        <span class="n">bash_command</span><span class="o">=</span><span class="s1">&#39;echo &quot;imagine that we transform a data&quot;&#39;</span><span class="p">,</span>
        <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span>
    <span class="p">)</span>
    <span class="n">odahuflow_conn</span> <span class="o">=</span> <span class="n">GcpConnectionToOdahuConnectionOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s1">&#39;odahuflow_connection_creation&#39;</span><span class="p">,</span>
        <span class="n">google_cloud_storage_conn_id</span><span class="o">=</span><span class="s1">&#39;wine_input&#39;</span><span class="p">,</span>
        <span class="n">api_connection_id</span><span class="o">=</span><span class="n">api_connection_id</span><span class="p">,</span>
        <span class="n">conn_template</span><span class="o">=</span><span class="n">wine</span><span class="p">,</span>
        <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span>
    <span class="p">)</span>

    <span class="n">train</span> <span class="o">=</span> <span class="n">TrainingOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;training&quot;</span><span class="p">,</span>
        <span class="n">api_connection_id</span><span class="o">=</span><span class="n">api_connection_id</span><span class="p">,</span>
        <span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">,</span>
        <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span>
    <span class="p">)</span>

    <span class="n">wait_for_train</span> <span class="o">=</span> <span class="n">TrainingSensor</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s1">&#39;wait_for_training&#39;</span><span class="p">,</span>
        <span class="n">training_id</span><span class="o">=</span><span class="n">training_id</span><span class="p">,</span>
        <span class="n">api_connection_id</span><span class="o">=</span><span class="n">api_connection_id</span><span class="p">,</span>
        <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span>
    <span class="p">)</span>

    <span class="n">pack</span> <span class="o">=</span> <span class="n">PackagingOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;packaging&quot;</span><span class="p">,</span>
        <span class="n">api_connection_id</span><span class="o">=</span><span class="n">api_connection_id</span><span class="p">,</span>
        <span class="n">packaging</span><span class="o">=</span><span class="n">packaging</span><span class="p">,</span>
        <span class="n">trained_task_id</span><span class="o">=</span><span class="s2">&quot;wait_for_training&quot;</span><span class="p">,</span>
        <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span>
    <span class="p">)</span>

    <span class="n">wait_for_pack</span> <span class="o">=</span> <span class="n">PackagingSensor</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s1">&#39;wait_for_packaging&#39;</span><span class="p">,</span>
        <span class="n">packaging_id</span><span class="o">=</span><span class="n">packaging_id</span><span class="p">,</span>
        <span class="n">api_connection_id</span><span class="o">=</span><span class="n">api_connection_id</span><span class="p">,</span>
        <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span>
    <span class="p">)</span>

    <span class="n">dep</span> <span class="o">=</span> <span class="n">DeploymentOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;deployment&quot;</span><span class="p">,</span>
        <span class="n">api_connection_id</span><span class="o">=</span><span class="n">api_connection_id</span><span class="p">,</span>
        <span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">,</span>
        <span class="n">packaging_task_id</span><span class="o">=</span><span class="s2">&quot;wait_for_packaging&quot;</span><span class="p">,</span>
        <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span>
    <span class="p">)</span>

    <span class="n">wait_for_dep</span> <span class="o">=</span> <span class="n">DeploymentSensor</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s1">&#39;wait_for_deployment&#39;</span><span class="p">,</span>
        <span class="n">deployment_id</span><span class="o">=</span><span class="n">deployment_id</span><span class="p">,</span>
        <span class="n">api_connection_id</span><span class="o">=</span><span class="n">api_connection_id</span><span class="p">,</span>
        <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span>
    <span class="p">)</span>

    <span class="n">model_predict_request</span> <span class="o">=</span> <span class="n">ModelPredictRequestOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;model_predict_request&quot;</span><span class="p">,</span>
        <span class="n">model_deployment_name</span><span class="o">=</span><span class="n">deployment_id</span><span class="p">,</span>
        <span class="n">api_connection_id</span><span class="o">=</span><span class="n">api_connection_id</span><span class="p">,</span>
        <span class="n">model_connection_id</span><span class="o">=</span><span class="n">model_connection_id</span><span class="p">,</span>
        <span class="n">request_body</span><span class="o">=</span><span class="n">model_example_request</span><span class="p">,</span>
        <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span>
    <span class="p">)</span>

    <span class="n">model_info_request</span> <span class="o">=</span> <span class="n">ModelInfoRequestOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s1">&#39;model_info_request&#39;</span><span class="p">,</span>
        <span class="n">model_deployment_name</span><span class="o">=</span><span class="n">deployment_id</span><span class="p">,</span>
        <span class="n">api_connection_id</span><span class="o">=</span><span class="n">api_connection_id</span><span class="p">,</span>
        <span class="n">model_connection_id</span><span class="o">=</span><span class="n">model_connection_id</span><span class="p">,</span>
        <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span>
    <span class="p">)</span>

<span class="hll">    <span class="n">data_extraction</span> <span class="o">&gt;&gt;</span> <span class="n">data_transformation</span> <span class="o">&gt;&gt;</span> <span class="n">odahuflow_conn</span> <span class="o">&gt;&gt;</span> <span class="n">train</span>
</span><span class="hll">    <span class="n">train</span> <span class="o">&gt;&gt;</span> <span class="n">wait_for_train</span> <span class="o">&gt;&gt;</span> <span class="n">pack</span> <span class="o">&gt;&gt;</span> <span class="n">wait_for_pack</span> <span class="o">&gt;&gt;</span> <span class="n">dep</span> <span class="o">&gt;&gt;</span> <span class="n">wait_for_dep</span>
</span><span class="hll">    <span class="n">wait_for_dep</span> <span class="o">&gt;&gt;</span> <span class="n">model_info_request</span>
</span><span class="hll">    <span class="n">wait_for_dep</span> <span class="o">&gt;&gt;</span> <span class="n">model_predict_request</span>
</span></pre></div>
</td></tr></table></div>
</div>
<p>In this file, we create four dags:</p>
<ul class="simple">
<li>DAG on line 190 extract and transform data, create Odahu-flow connection and run <a class="reference internal" href="gen_glossary.html#term-train"><span class="xref std std-term">Train</span></a></li>
<li>DAG on line 191 sequentially run phases <a class="reference internal" href="gen_glossary.html#term-train"><span class="xref std std-term">Train</span></a>, <a class="reference internal" href="gen_glossary.html#term-package"><span class="xref std std-term">Package</span></a>, <a class="reference internal" href="gen_glossary.html#term-deploy"><span class="xref std std-term">Deploy</span></a></li>
<li>DAG on line 192 wait for model deploy and then extract schema of model predict API</li>
<li>DAG on line 193 wait for model deploy and then invoke model prediction API</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="int_jupyterlab_extension.html" class="btn btn-neutral float-right" title="JupyterLab extension" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="int_metrics.html" class="btn btn-neutral" title="Metrics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Odahu Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.0-rc27',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>